# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a **pnpm monorepo** workspace containing a webhook inspector application with two packages:
- **api**: Fastify-based REST API with PostgreSQL database (Drizzle ORM)
- **web**: React SPA using Vite and TanStack Router

The application captures and inspects incoming webhook requests, storing details like headers, body, query params, IP address, and more.

## Development Setup

### Prerequisites
- pnpm 10.15.0 (managed via packageManager field)
- Docker (for PostgreSQL database)

### Initial Setup
```bash
# Install dependencies (from root)
pnpm install

# Start PostgreSQL database (from api directory)
cd api
docker compose up -d

# Generate and run database migrations
pnpm db:generate
pnpm db:migrate

# Optional: seed database with sample data
pnpm db:seed
```

## Common Commands

### API (from `api/` directory)
- `pnpm dev` - Start development server with hot reload (runs on port 3333)
- `pnpm format` - Format code with Biome
- `pnpm db:generate` - Generate Drizzle migrations from schema changes
- `pnpm db:migrate` - Apply pending migrations to database
- `pnpm db:studio` - Open Drizzle Studio for database GUI
- `pnpm db:seed` - Seed database with sample data

### Web (from `web/` directory)
- `pnpm dev` - Start Vite development server
- `pnpm build` - Type-check and build for production
- `pnpm preview` - Preview production build locally
- `pnpm format` - Format code with Biome

### Root
Commands should typically be run from the specific workspace (api/web), not from root.

## Architecture

### API Architecture (api/)

**Stack**: Fastify + Drizzle ORM + PostgreSQL + Zod + TypeScript

**Key Components**:
- `src/server.ts` - Fastify server setup with Swagger docs, CORS, type providers
- `src/routes/` - Route handlers following plugin pattern (each route is a Fastify plugin)
- `src/db/schema/` - Drizzle table schemas (currently just `webhooks` table)
- `src/db/migrations/` - Auto-generated SQL migrations
- `src/db/index.ts` - Database connection and Drizzle instance
- `src/env.ts` - Environment variable validation

**Route Pattern**: Each route file exports a `FastifyPluginAsyncZod` that registers routes with:
- Zod schema validation for request/response
- Automatic OpenAPI/Swagger documentation
- Type-safe request/reply handling

**Database**:
- Uses Drizzle ORM with PostgreSQL dialect
- Schema defined in `src/db/schema/webhooks.ts`
- Table naming convention: snake_case (via drizzle.config.ts)
- Primary keys use UUIDv7 for time-ordered IDs
- Webhooks table stores: method, pathname, ip, statusCode, headers (JSONB), body, queryParams (JSONB), etc.

**API Documentation**: Available at `http://localhost:3333/docs` (Scalar UI)

### Web Architecture (web/)

**Stack**: React 19 + Vite + TanStack Router + Tailwind CSS v4 + TypeScript

**Key Components**:
- `src/main.tsx` - App entry point with router setup
- `src/routes/` - File-based routing via TanStack Router
- `src/routeTree.gen.ts` - Auto-generated route tree (do not edit manually)
- `src/components/` - React components
- `src/components/ui/` - Reusable UI components

**Router**: Uses TanStack Router with file-based routing. The route tree is auto-generated by the `@tanstack/router-plugin` Vite plugin.

**Styling**: Tailwind CSS v4 with utility classes. Uses `tailwind-merge` and `tailwind-variants` for component variants.

**UI Libraries**:
- Radix UI for accessible primitives (checkbox, etc.)
- Lucide React for icons
- react-resizable-panels for split layouts
- Shiki for syntax highlighting

## Code Style

Both packages use **Biome** for formatting (not Prettier/ESLint). Configuration in `biome.json` files.

## Database Workflow

When making schema changes:
1. Edit schema files in `src/db/schema/`
2. Run `pnpm db:generate` to create migration SQL
3. Run `pnpm db:migrate` to apply migrations
4. Review generated SQL in `src/db/migrations/` before committing

## Important Notes

- The monorepo uses pnpm workspaces - always use `pnpm` not `npm`
- API server runs on port 3333 with CORS enabled for local development
- Database runs in Docker on port 5432 (credentials: docker/docker)
- Route files in both API and web follow specific patterns - study existing routes before adding new ones
- TanStack Router uses file-based routing - routes are defined in `src/routes/` and tree is auto-generated
- Both packages share the same TypeScript version (~5.9.3)
